{% extends 'base.html' %}

{% block title %}Search{% endblock %}

{% block header %}
<div class="container-xl">
  <div class="row">
    <div class="col">
      <a class="" href="{{ url_for('index') }}">
        <i data-feather="arrow-left-circle" width="28" height="28"></i>
      </a>
    </div>
  </div>
</div>

<div class="container-xl mt-2 mb-3">
  <form class="inputform" method="post" action="{{ url_for('search.index') }}">
    {{ form.hidden_tag() }}
    <div class="row">
      <div class="col mb-2">
        <div class="input-group">
          <span class="input-group-text">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
          </span>
          {{ form.start_date(class_="form-control") }}
        </div>
      </div>
      <div class="col mb-2">
        <div class="input-group">
          <span class="input-group-text">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
          </span>
          {{ form.end_date(class_="form-control") }}
        </div>
      </div>
    </div>
    <div class="form-row justify-content-center my-2">
      <div class="mb-3 input-group">
        <span class="input-group-text">
          <i class="bi bi-pencil"></i>
        </span>
        {{ form.description(class_="form-control", placeholder="Coop: bread, butter, milk") }}
      </div>
      <div>
          {{ form.submit(class_="btn btn-outline-success") }}
      </div>
    </div>
  </form>
</div>
{% endblock %}

{% block content %}
{% if items %}
<div class="container-xl mb-3 mt-3">
  <div class="card">
    <div class="card-body">
      <div class="row">
        <div class="col offset-1">Income</div>
        <div class="col">Expenses</div>
        <div class="col">Saldo</div>
      </div>
      <div class="row justify-content-center">
        <div class="col offset-1 text-primary" id="sum_income">&euro; </div>
        <div class="col text-danger" id="sum_expenses">&euro; </div>
        <div class="col text-secondary" id="saldo">&euro; </div>
      </div>
    </div>
  </div>
</div>
{% endif %}
<div class="container-xl mt-3" {%if not items %}style="visibility: hidden"{% endif %}>
  <table id="data" class="table table-striped">
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Amount</th>
        <th>Payment</th>
        <th>Description</th>
        <th>Category</th>
      </tr>
    </thead>
    {% if items %}
    <tbody>
      {% for i in items %}
        <tr>
          <td>{{ i.date }}</td>
          <td>{{ i.itemtype }}</td>
          <td {%if i.itemtype=="revenue" %}class="success"{% else %}class=""{% endif %}>{{ i.amount }}</td>
          <td>{{ i.payment }}</td>
          <td><a href="{{ url_for('items.edit',item_id=i.id) }}" class="text-secondary">{{ i.description }}</a></td>
          <td>{{ i.category }}</td>
        </tr>
      {% endfor %}
    </tbody>
    {% endif %}
  </table>
</div>

{% endblock %}

{% block script %}
<script>
  jQuery.fn.dataTable.Api.register( 'sum2()', function ( ) {
    return this.flatten().reduce( function ( a, b ) {
        var x = parseFloat(a) || 0;
        var y = parseFloat(b) || 0;
        return x + y
    }, 0 );
  } );
  // https://datatables.net/plug-ins/api/sum()
  jQuery.fn.dataTable.Api.register( 'sum()', function ( ) {
    return this.flatten().reduce( function ( a, b ) {
        if ( typeof a === 'string' ) {
            a = a.replace(/[^\d.-]/g, '') * 1;
        }
        if ( typeof b === 'string' ) {
            b = b.replace(/[^\d.-]/g, '') * 1;
        }

        return a + b;
    }, 0 );
} );

  $(document).ready(function () {
      $('#data').DataTable({
          responsive: true,
          pageLength: 25,
          columns: [
              null,
              null,
              {searchable: false},
              {orderable: false, searchable: false},
              null,
              null
          ],
          footerCallBack: function () {
            var api = this.api();
            // $( '#sum_expenses' ).html(
            //   api.column( 2, {page:'current'} ).data().sum()
            // );
            $( this.footer()).html("foo");
          }
      });
  });
</script>
{% endblock %}

