{% extends 'base.html' %}

{% block title %}Show items{% endblock %}

{% set this_year, this_month = g.curr_month.split("/") %}
{% set this_year = this_year | int %}
{% set this_month = this_month | int %}
{% if this_month < 10 %}
  {% set this_month_padded = "0" ~ this_month %}
{% else %}
  {% set this_month_padded = this_month %}
{% endif %}
{% set next_year, next_month = g.next_month.split("/") %}
{% set prev_year, prev_month = g.prev_month.split("/") %}

{% block header %}
<section class="bg-dark text-light p-2 text-center text-sm-start">
  <div class="container">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="collapse navbar-collapse" id="navbarMonths">
        <ul class="navbar-nav">
          <li class="nav-item pe-2">
            <a class="nav-link bg-info" href="{{ url_for('items.show', year=prev_year, month=prev_month) }}">
              <img src="/static/img/arrow-left-square.svg" alt="" width="18" height="18" title="backward" />
            </a>
          </li>
          <li class="nav-item px-2">
            <input class="form-control" id="date-month-selector" required type="month"
                   value="{{ this_year }}-{{ this_month_padded }}"
                   onchange="redirect_to_month(event)"
            >
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link bg-info" href="{{ url_for('items.show', year=next_year, month=next_month) }}"><img src="/static/img/arrow-right-square.svg" alt="" width="18" height="18" title="forward" /></a>
          </li>
          <li class="nav-item px-5">
            <a class="nav-link bg-info" href="{{ url_for('items.create') }}"><img src="/static/img/plus-square.svg" alt="" width="18" height="18" title="add entry" /></a>
          </li>
          <li class="nav-item px-5">
            <form class="d-flex" method="post" action="{{ url_for('search.index') }}">
              {{ search_form.hidden_tag() }}
              {{ search_form.description(class_="form-control me-2", placeholder="Search") }}
              {{ search_form.submit(class_="btn btn-outline-info my-2 my-sm-0") }}
            </form>
          </li>
        </ul>
      </div>
    </nav>
  </div>
</section>
{% endblock %}


{% block content %}
{% if items and this_year in items %}
  {% set sum_revenues = items[this_year][this_month]['sum_revenues'] %}
  {% set sum_expenditures = items[this_year][this_month]['sum_expenditures'] %}
  {% set saldo = sum_revenues - sum_expenditures %}
{% else %}
  {% set sum_revenues = 0 %}
  {% set sum_expenditures = 0 %}
  {% set saldo = 0 %}
{% endif %}
<div class="container-fluid mb-3">
  <div class="card">
    <div class="card-body">
      <div class="row">
        <div class="col offset-1">Revenues</div>
        <div class="col">Expenditures</div>
        <div class="col">Saldo</div>
      </div>
      <div class="row justify-content-center">
        <div class="col offset-1 text-primary">&euro; {{ "%.2f"|format(sum_revenues) }}</div>
        <div class="col text-danger">&euro; {{ "%.2f"|format(sum_expenditures) }}</div>

        <div class="col text-secondary">&euro; {{ "%.2f"|format(saldo) }}</div>
      </div>
    </div>
  </div>
</div>

{% include 'items/render_items.html' %}
{% endblock %}


{% block script %}
<script type="text/javascript">
    function redirect_to_month(e) {
      const items = e.target.value.split("-");
      const selected_year = items[0];
      const selected_month = items[1];
      const new_base_path = '../' + selected_year + '/' + selected_month;
      const url = new URL(new_base_path, window.location.href);
      window.location.href=url;
    }
</script>
{% endblock %}
